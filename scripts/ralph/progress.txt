## Codebase Patterns
- uv is not pre-installed in this environment; install via `curl -LsSf https://astral.sh/uv/install.sh | sh`
- Alpine Linux environment - use `sudo apk add` for system packages, needs `gcc g++ musl-dev` for scikit-learn build
- Add new CLI/script files to `[tool.vulture] exclude` in pyproject.toml to avoid false positives on CLI entry points
- Set git identity with `git config user.email/user.name` before committing (not pre-configured)
- ruff C901 complexity limit is 10; extract helpers to keep functions under this limit
- ruff B904: `raise` inside `except` must use `from err` or `from None`
- pytest runs with `-n auto` by default (parallel); override with `-o "addopts=-n0"` for single-threaded
- Use `TERM=dumb OPENBLAS_NUM_THREADS=1` to avoid terminal/thread warnings in this environment
- `onboard.py` is the interactive CLI entry point; `make onboard` invokes it

# Ralph Progress Log
Started: Mon Feb 23 23:48:11 UTC 2026
---

## 2026-02-24 - US-001
- Created `onboard.py` at project root with typer CLI scaffold
- Added `typer` and `questionary` as project dependencies via `uv add`
- 5 subcommands: rename, deps, env, hooks, media - all with placeholder implementations
- Running with no args calls main orchestrator (placeholder)
- `--help` shows all subcommands
- Added `onboard.py` to vulture exclusions in pyproject.toml
- Files changed: onboard.py (new), pyproject.toml, uv.lock
- **Learnings for future iterations:**
  - uv needs to be installed first in this environment
  - Alpine needs gcc/g++/musl-dev for scikit-learn (transitive dep from scrubadub)
  - typer's `invoke_without_command=True` + `@app.callback` pattern handles no-subcommand invocation
---

## 2026-02-24 - US-002
- Implemented `rename` subcommand in onboard.py
- Prompts for kebab-case project name with regex validation
- Prompts for free-text description
- Updates pyproject.toml name and description fields
- Updates README.md heading and tagline
- Shows rich Panel summary of changes
- Skips with info message if project already renamed (name != 'python-template')
- Files changed: onboard.py
- **Learnings for future iterations:**
  - README tagline is wrapped in `<b>` tags: `<b>Opinionated Python project stack. ðŸ”‹ Batteries included. </b>`
  - questionary returns None on Ctrl+C; use `typer.Abort()` to handle cancellation
  - `_validate_kebab_case` returns `True` or error string for questionary validation
---

## 2026-02-24 - US-003
- Implemented `deps` subcommand in onboard.py
- Checks uv availability via `shutil.which('uv')`
- Creates .venv via `uv venv` if not exists
- Runs `uv sync` with rich spinner
- Shows green success or red error messages
- Files changed: onboard.py
- **Learnings for future iterations:**
  - Use `rich.console.Console().status()` for spinner display
  - `subprocess.run` with `capture_output=True` for clean output handling
---

## 2026-02-24 - US-004
- Implemented `env` subcommand in onboard.py
- Parses .env.example for groups (comment lines) and key/value pairs
- Loads existing .env and identifies configured keys (non-placeholder values)
- Presents questionary.checkbox with grouped keys, pre-checking configured ones
- Uses questionary.password for SECRET/KEY/TOKEN/PASSWORD keys
- Asks to keep existing values for already-configured keys
- Writes .env preserving group structure, commenting out unselected keys
- Refactored into helper functions to keep complexity under ruff C901 limit (max 10)
- Files changed: onboard.py
- **Learnings for future iterations:**
  - ruff C901 complexity limit is 10; env step needed 3 helper functions to comply
  - .env.example uses `# Group Name` comments to define sections
  - Placeholder values like `sk-...` need to be treated as empty
---

## 2026-02-24 - US-005
- Implemented `hooks` subcommand in onboard.py
- Reads .pre-commit-config.yaml and lists hooks in a rich Table
- Prompts for activation with questionary.confirm (default=True)
- Runs `git config core.hooksPath .githooks` on activation
- Shows helpful message with manual command on decline
- Files changed: onboard.py
- **Learnings for future iterations:**
  - .pre-commit-config.yaml has repos > hooks structure with id and name fields
  - yaml import done inside function to avoid top-level import (only needed for hooks)
---

## 2026-02-24 - US-006
- Refactored init/generate_banner.py: renamed `suggestion` param to `theme` in BannerDescription signature and generate_banner() function
- Refactored init/generate_logo.py: renamed `suggestion` param to `theme` in WordmarkDescription signature and generate_logo() function
- __main__ blocks updated to use `theme` variable name
- `make banner` and `make logo` still work (they call `__main__` blocks)
- Files changed: init/generate_banner.py, init/generate_logo.py
- **Learnings for future iterations:**
  - Both scripts already accepted parameters; the main change was renaming `suggestion` â†’ `theme`
  - generate_banner returns Image.Image; generate_logo returns dict[str, Image.Image]
  - generate_logo also accepts `output_dir` parameter (defaults to docs/public/)
---

## 2026-02-24 - US-007
- Implemented `media` subcommand in onboard.py
- Checks GEMINI_API_KEY in .env and os.environ
- Offers to skip if key not configured
- Prompts for theme/style description
- questionary.select for: Banner only, Logo only, Both, Skip
- Calls refactored generate_banner() / generate_logo() with project name from pyproject.toml
- Shows spinner during generation, prints generated file paths
- Extracted `_run_media_generation()` helper to keep C901 complexity under 10
- Files changed: onboard.py
- **Learnings for future iterations:**
  - `_check_gemini_key()` reads .env directly (not through dotenv) to check key presence
  - Local imports of init modules used inside function to avoid import errors at CLI startup
---

## 2026-02-24 - US-008
- Implemented full onboarding orchestrator in `_run_orchestrator()`
- Shows welcome Panel with project name and step overview
- Runs all 5 steps in order: rename, deps, env, hooks, media
- Each step shows "Step N/5: Name" header
- Users can skip individual steps via Yes/Skip select
- If a step fails (non-zero exit), asks whether to continue or abort
- Final summary Panel shows completed (green checkmarks) and skipped (yellow dashes)
- Includes suggested next commands: make test, make ci, make all
- Uses STEP_FUNCTIONS dict to register step functions after definition
- Extracted `_print_summary()` helper
- Files changed: onboard.py
- **Learnings for future iterations:**
  - ruff B904: raise in except must use `from err` or `from None`
  - ruff F541: f-strings without placeholders are flagged
  - typer.Exit and SystemExit both caught for step failure handling
---

## 2026-02-24 - US-009
- Removed `make init`, `make setup`, `make setup_githooks` targets from Makefile
- Added `make onboard` target that runs `uv run python onboard.py`
- Updated `make all` to use `uv sync` directly instead of `setup` + `setup_githooks`
- Updated CLAUDE.md: replaced `make init`/`make setup` references with `make onboard` and CLI subcommands
- Updated README.md Quick Start: replaced `make init` with `make onboard`, added CLI subcommand docs
- All 15 tests pass, typecheck passes, ruff passes
- Files changed: Makefile, CLAUDE.md, README.md
- **Learnings for future iterations:**
  - `make all` depended on `setup` and `setup_githooks` - updated to `check_uv` + inline `uv sync`
  - pytest.ini has `addopts = -n auto` which runs tests in parallel by default
  - Use `-o "addopts=-n0"` to override and run tests single-threaded
---
