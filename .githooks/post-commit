#!/usr/bin/env python3

import subprocess
import sys

def run_ci():
    """Run CI checks (ruff, vulture, ty) after commit."""
    print("\nRunning CI checks (make ci)...")
    result = subprocess.run(["make", "ci"], capture_output=True, text=True)

    if result.returncode != 0:
        print("❌ CI checks failed:")
        print(result.stdout)
        print(result.stderr)
        print("\nCommit was created, but CI checks failed.")
        print("Please fix the issues and amend your commit:")
        print("  git add <files>")
        print("  git commit --amend --no-edit")
        return False

    print("✓ CI checks passed")
    return True

if not run_ci():
    print("\n⚠️  Post-commit hook: CI checks failed (commit was still created)")
    sys.exit(1)

print("✓ Post-commit hook: All checks passed")
sys.exit(0)
